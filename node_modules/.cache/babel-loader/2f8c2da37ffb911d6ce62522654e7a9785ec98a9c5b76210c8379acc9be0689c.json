{"ast":null,"code":"var _idl$metadata;\n// src/escrow.js\n\nimport * as anchor from \"@coral-xyz/anchor\";\nimport { PublicKey, SystemProgram } from \"@solana/web3.js\";\nimport idl from \"./idl/typeracer_escrow.json\";\n\n// Program ID from the IDL metadata (fallback to idl.address for older IDLs)\nconst PROGRAM_ID = new PublicKey(((_idl$metadata = idl.metadata) === null || _idl$metadata === void 0 ? void 0 : _idl$metadata.address) || idl.address);\n\n/**\n * Returns a typed Program client. You must have called setProvider()\n * (from your solana.js) before calling any of these.\n */\nfunction getProgram() {\n  const provider = anchor.getProvider();\n  if (!provider) throw new Error(\"Provider not set. Call setProvider in App.jsx first.\");\n  return new anchor.Program(idl, PROGRAM_ID, provider);\n}\n\n/**\n * Build Initialize + Deposit instructions;\n * App.jsx will sign+send these.\n */\nexport async function buildInitializeAndDepositIxns(wagerLamports) {\n  const program = getProgram();\n  const provider = anchor.getProvider();\n  const nonce = Math.floor(Math.random() * 1000000);\n\n  // derive the PDA for this escrow\n  const [escrowPda] = await PublicKey.findProgramAddress([Buffer.from(\"escrow\"), provider.wallet.publicKey.toBuffer(), new anchor.BN(nonce).toArrayLike(Buffer, \"le\", 8)], program.programId);\n\n  // initialize\n  const ixInit = await program.methods.initialize(new anchor.BN(wagerLamports), new anchor.BN(nonce)).accounts({\n    escrow: escrowPda,\n    player1: provider.wallet.publicKey,\n    authority: provider.wallet.publicKey,\n    systemProgram: SystemProgram.programId\n  }).instruction();\n\n  // deposit\n  const ixDeposit = await program.methods.deposit().accounts({\n    escrow: escrowPda,\n    payer: provider.wallet.publicKey,\n    escrowAccount: escrowPda,\n    systemProgram: SystemProgram.programId\n  }).instruction();\n  return {\n    ixInit,\n    ixDeposit,\n    escrowPda\n  };\n}\n\n/**\n * Build the JoinAndDeposit instruction.\n */\nexport async function buildJoinAndDepositIxn(escrowPda) {\n  const program = getProgram();\n  const provider = anchor.getProvider();\n\n  // fetch on‑chain Escrow to confirm PDA\n  const acct = await program.account.escrow.fetch(escrowPda);\n  // use the PDA itself as the vault account\n  const vault = escrowPda;\n  const ix = await program.methods.joinAndDeposit().accounts({\n    escrow: escrowPda,\n    player2: provider.wallet.publicKey,\n    escrowAccount: vault,\n    systemProgram: SystemProgram.programId\n  }).instruction();\n  return ix;\n}\n\n/**\n * Build the Cancel instruction.\n */\nexport async function buildCancelIxn(escrowPda, player1Pubkey, player2Pubkey) {\n  const program = getProgram();\n  const provider = anchor.getProvider();\n  const acct = await program.account.escrow.fetch(escrowPda);\n  const vault = escrowPda;\n  const ix = await program.methods.cancel().accounts({\n    escrow: escrowPda,\n    player1: player1Pubkey,\n    player2: player2Pubkey,\n    escrowAccount: vault,\n    authority: provider.wallet.publicKey\n  }).instruction();\n  return ix;\n}\n\n/**\n * Build the Resolve instruction.\n */\nexport async function buildResolveIxn(escrowPda, winnerPubkey) {\n  const program = getProgram();\n  const provider = anchor.getProvider();\n  const acct = await program.account.escrow.fetch(escrowPda);\n  const vault = escrowPda;\n  const ix = await program.methods.resolve(winnerPubkey).accounts({\n    escrow: escrowPda,\n    winner: winnerPubkey,\n    house: provider.wallet.publicKey,\n    escrowAccount: vault,\n    authority: provider.wallet.publicKey\n  }).instruction();\n  return ix;\n}","map":{"version":3,"names":["anchor","PublicKey","SystemProgram","idl","PROGRAM_ID","_idl$metadata","metadata","address","getProgram","provider","getProvider","Error","Program","buildInitializeAndDepositIxns","wagerLamports","program","nonce","Math","floor","random","escrowPda","findProgramAddress","Buffer","from","wallet","publicKey","toBuffer","BN","toArrayLike","programId","ixInit","methods","initialize","accounts","escrow","player1","authority","systemProgram","instruction","ixDeposit","deposit","payer","escrowAccount","buildJoinAndDepositIxn","acct","account","fetch","vault","ix","joinAndDeposit","player2","buildCancelIxn","player1Pubkey","player2Pubkey","cancel","buildResolveIxn","winnerPubkey","resolve","winner","house"],"sources":["/home/kokoi/sol-wager-app/frontend/src/escrow.js"],"sourcesContent":["// src/escrow.js\n\nimport * as anchor from \"@coral-xyz/anchor\";\nimport { PublicKey, SystemProgram } from \"@solana/web3.js\";\nimport idl from \"./idl/typeracer_escrow.json\";\n\n// Program ID from the IDL metadata (fallback to idl.address for older IDLs)\nconst PROGRAM_ID = new PublicKey(idl.metadata?.address || idl.address);\n\n/**\n * Returns a typed Program client. You must have called setProvider()\n * (from your solana.js) before calling any of these.\n */\nfunction getProgram() {\n  const provider = anchor.getProvider();\n  if (!provider) throw new Error(\"Provider not set. Call setProvider in App.jsx first.\");\n  return new anchor.Program(idl, PROGRAM_ID, provider);\n}\n\n/**\n * Build Initialize + Deposit instructions;\n * App.jsx will sign+send these.\n */\nexport async function buildInitializeAndDepositIxns(wagerLamports) {\n  const program = getProgram();\n  const provider = anchor.getProvider();\n  const nonce = Math.floor(Math.random() * 1_000_000);\n\n  // derive the PDA for this escrow\n  const [escrowPda] = await PublicKey.findProgramAddress(\n    [\n      Buffer.from(\"escrow\"),\n      provider.wallet.publicKey.toBuffer(),\n      new anchor.BN(nonce).toArrayLike(Buffer, \"le\", 8),\n    ],\n    program.programId\n  );\n\n  // initialize\n  const ixInit = await program.methods\n    .initialize(new anchor.BN(wagerLamports), new anchor.BN(nonce))\n    .accounts({\n      escrow: escrowPda,\n      player1: provider.wallet.publicKey,\n      authority: provider.wallet.publicKey,\n      systemProgram: SystemProgram.programId,\n    })\n    .instruction();\n\n  // deposit\n  const ixDeposit = await program.methods\n    .deposit()\n    .accounts({\n      escrow: escrowPda,\n      payer: provider.wallet.publicKey,\n      escrowAccount: escrowPda,\n      systemProgram: SystemProgram.programId,\n    })\n    .instruction();\n\n  return { ixInit, ixDeposit, escrowPda };\n}\n\n/**\n * Build the JoinAndDeposit instruction.\n */\nexport async function buildJoinAndDepositIxn(escrowPda) {\n  const program = getProgram();\n  const provider = anchor.getProvider();\n\n  // fetch on‑chain Escrow to confirm PDA\n  const acct = await program.account.escrow.fetch(escrowPda);\n  // use the PDA itself as the vault account\n  const vault = escrowPda;\n\n  const ix = await program.methods\n    .joinAndDeposit()\n    .accounts({\n      escrow: escrowPda,\n      player2: provider.wallet.publicKey,\n      escrowAccount: vault,\n      systemProgram: SystemProgram.programId,\n    })\n    .instruction();\n\n  return ix;\n}\n\n/**\n * Build the Cancel instruction.\n */\nexport async function buildCancelIxn(escrowPda, player1Pubkey, player2Pubkey) {\n  const program = getProgram();\n  const provider = anchor.getProvider();\n\n  const acct = await program.account.escrow.fetch(escrowPda);\n  const vault = escrowPda;\n\n  const ix = await program.methods\n    .cancel()\n    .accounts({\n      escrow: escrowPda,\n      player1: player1Pubkey,\n      player2: player2Pubkey,\n      escrowAccount: vault,\n      authority: provider.wallet.publicKey,\n    })\n    .instruction();\n\n  return ix;\n}\n\n/**\n * Build the Resolve instruction.\n */\nexport async function buildResolveIxn(escrowPda, winnerPubkey) {\n  const program = getProgram();\n  const provider = anchor.getProvider();\n\n  const acct = await program.account.escrow.fetch(escrowPda);\n  const vault = escrowPda;\n\n  const ix = await program.methods\n    .resolve(winnerPubkey)\n    .accounts({\n      escrow: escrowPda,\n      winner: winnerPubkey,\n      house: provider.wallet.publicKey,\n      escrowAccount: vault,\n      authority: provider.wallet.publicKey,\n    })\n    .instruction();\n\n  return ix;\n}\n"],"mappings":";AAAA;;AAEA,OAAO,KAAKA,MAAM,MAAM,mBAAmB;AAC3C,SAASC,SAAS,EAAEC,aAAa,QAAQ,iBAAiB;AAC1D,OAAOC,GAAG,MAAM,6BAA6B;;AAE7C;AACA,MAAMC,UAAU,GAAG,IAAIH,SAAS,CAAC,EAAAI,aAAA,GAAAF,GAAG,CAACG,QAAQ,cAAAD,aAAA,uBAAZA,aAAA,CAAcE,OAAO,KAAIJ,GAAG,CAACI,OAAO,CAAC;;AAEtE;AACA;AACA;AACA;AACA,SAASC,UAAUA,CAAA,EAAG;EACpB,MAAMC,QAAQ,GAAGT,MAAM,CAACU,WAAW,CAAC,CAAC;EACrC,IAAI,CAACD,QAAQ,EAAE,MAAM,IAAIE,KAAK,CAAC,sDAAsD,CAAC;EACtF,OAAO,IAAIX,MAAM,CAACY,OAAO,CAACT,GAAG,EAAEC,UAAU,EAAEK,QAAQ,CAAC;AACtD;;AAEA;AACA;AACA;AACA;AACA,OAAO,eAAeI,6BAA6BA,CAACC,aAAa,EAAE;EACjE,MAAMC,OAAO,GAAGP,UAAU,CAAC,CAAC;EAC5B,MAAMC,QAAQ,GAAGT,MAAM,CAACU,WAAW,CAAC,CAAC;EACrC,MAAMM,KAAK,GAAGC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,GAAG,OAAS,CAAC;;EAEnD;EACA,MAAM,CAACC,SAAS,CAAC,GAAG,MAAMnB,SAAS,CAACoB,kBAAkB,CACpD,CACEC,MAAM,CAACC,IAAI,CAAC,QAAQ,CAAC,EACrBd,QAAQ,CAACe,MAAM,CAACC,SAAS,CAACC,QAAQ,CAAC,CAAC,EACpC,IAAI1B,MAAM,CAAC2B,EAAE,CAACX,KAAK,CAAC,CAACY,WAAW,CAACN,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC,CAClD,EACDP,OAAO,CAACc,SACV,CAAC;;EAED;EACA,MAAMC,MAAM,GAAG,MAAMf,OAAO,CAACgB,OAAO,CACjCC,UAAU,CAAC,IAAIhC,MAAM,CAAC2B,EAAE,CAACb,aAAa,CAAC,EAAE,IAAId,MAAM,CAAC2B,EAAE,CAACX,KAAK,CAAC,CAAC,CAC9DiB,QAAQ,CAAC;IACRC,MAAM,EAAEd,SAAS;IACjBe,OAAO,EAAE1B,QAAQ,CAACe,MAAM,CAACC,SAAS;IAClCW,SAAS,EAAE3B,QAAQ,CAACe,MAAM,CAACC,SAAS;IACpCY,aAAa,EAAEnC,aAAa,CAAC2B;EAC/B,CAAC,CAAC,CACDS,WAAW,CAAC,CAAC;;EAEhB;EACA,MAAMC,SAAS,GAAG,MAAMxB,OAAO,CAACgB,OAAO,CACpCS,OAAO,CAAC,CAAC,CACTP,QAAQ,CAAC;IACRC,MAAM,EAAEd,SAAS;IACjBqB,KAAK,EAAEhC,QAAQ,CAACe,MAAM,CAACC,SAAS;IAChCiB,aAAa,EAAEtB,SAAS;IACxBiB,aAAa,EAAEnC,aAAa,CAAC2B;EAC/B,CAAC,CAAC,CACDS,WAAW,CAAC,CAAC;EAEhB,OAAO;IAAER,MAAM;IAAES,SAAS;IAAEnB;EAAU,CAAC;AACzC;;AAEA;AACA;AACA;AACA,OAAO,eAAeuB,sBAAsBA,CAACvB,SAAS,EAAE;EACtD,MAAML,OAAO,GAAGP,UAAU,CAAC,CAAC;EAC5B,MAAMC,QAAQ,GAAGT,MAAM,CAACU,WAAW,CAAC,CAAC;;EAErC;EACA,MAAMkC,IAAI,GAAG,MAAM7B,OAAO,CAAC8B,OAAO,CAACX,MAAM,CAACY,KAAK,CAAC1B,SAAS,CAAC;EAC1D;EACA,MAAM2B,KAAK,GAAG3B,SAAS;EAEvB,MAAM4B,EAAE,GAAG,MAAMjC,OAAO,CAACgB,OAAO,CAC7BkB,cAAc,CAAC,CAAC,CAChBhB,QAAQ,CAAC;IACRC,MAAM,EAAEd,SAAS;IACjB8B,OAAO,EAAEzC,QAAQ,CAACe,MAAM,CAACC,SAAS;IAClCiB,aAAa,EAAEK,KAAK;IACpBV,aAAa,EAAEnC,aAAa,CAAC2B;EAC/B,CAAC,CAAC,CACDS,WAAW,CAAC,CAAC;EAEhB,OAAOU,EAAE;AACX;;AAEA;AACA;AACA;AACA,OAAO,eAAeG,cAAcA,CAAC/B,SAAS,EAAEgC,aAAa,EAAEC,aAAa,EAAE;EAC5E,MAAMtC,OAAO,GAAGP,UAAU,CAAC,CAAC;EAC5B,MAAMC,QAAQ,GAAGT,MAAM,CAACU,WAAW,CAAC,CAAC;EAErC,MAAMkC,IAAI,GAAG,MAAM7B,OAAO,CAAC8B,OAAO,CAACX,MAAM,CAACY,KAAK,CAAC1B,SAAS,CAAC;EAC1D,MAAM2B,KAAK,GAAG3B,SAAS;EAEvB,MAAM4B,EAAE,GAAG,MAAMjC,OAAO,CAACgB,OAAO,CAC7BuB,MAAM,CAAC,CAAC,CACRrB,QAAQ,CAAC;IACRC,MAAM,EAAEd,SAAS;IACjBe,OAAO,EAAEiB,aAAa;IACtBF,OAAO,EAAEG,aAAa;IACtBX,aAAa,EAAEK,KAAK;IACpBX,SAAS,EAAE3B,QAAQ,CAACe,MAAM,CAACC;EAC7B,CAAC,CAAC,CACDa,WAAW,CAAC,CAAC;EAEhB,OAAOU,EAAE;AACX;;AAEA;AACA;AACA;AACA,OAAO,eAAeO,eAAeA,CAACnC,SAAS,EAAEoC,YAAY,EAAE;EAC7D,MAAMzC,OAAO,GAAGP,UAAU,CAAC,CAAC;EAC5B,MAAMC,QAAQ,GAAGT,MAAM,CAACU,WAAW,CAAC,CAAC;EAErC,MAAMkC,IAAI,GAAG,MAAM7B,OAAO,CAAC8B,OAAO,CAACX,MAAM,CAACY,KAAK,CAAC1B,SAAS,CAAC;EAC1D,MAAM2B,KAAK,GAAG3B,SAAS;EAEvB,MAAM4B,EAAE,GAAG,MAAMjC,OAAO,CAACgB,OAAO,CAC7B0B,OAAO,CAACD,YAAY,CAAC,CACrBvB,QAAQ,CAAC;IACRC,MAAM,EAAEd,SAAS;IACjBsC,MAAM,EAAEF,YAAY;IACpBG,KAAK,EAAElD,QAAQ,CAACe,MAAM,CAACC,SAAS;IAChCiB,aAAa,EAAEK,KAAK;IACpBX,SAAS,EAAE3B,QAAQ,CAACe,MAAM,CAACC;EAC7B,CAAC,CAAC,CACDa,WAAW,CAAC,CAAC;EAEhB,OAAOU,EAAE;AACX","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}