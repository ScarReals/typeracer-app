{"ast":null,"code":"// src/escrow.js\nimport * as anchor from \"@coral-xyz/anchor\";\nimport { PublicKey, SystemProgram } from \"@solana/web3.js\";\nimport idl from \"./idl/typeracer_escrow.json\";\nconst PROGRAM_ID = new PublicKey(idl.metadata.address);\n\n/** \n * @param {number} wagerLamports \n * @param {anchor.AnchorProvider} provider \n * @returns {Promise<PublicKey>} PDA \n */\nexport async function initializeEscrow(wagerLamports, provider) {\n  const program = new anchor.Program(idl, PROGRAM_ID, provider);\n  const nonce = Math.floor(Math.random() * 1000000);\n  const [escrowPDA] = await PublicKey.findProgramAddress([Buffer.from(\"escrow\"), provider.wallet.publicKey.toBuffer(), new anchor.BN(nonce).toArrayLike(Buffer, \"le\", 8)], program.programId);\n  await program.methods.initialize(new anchor.BN(wagerLamports), new anchor.BN(nonce)).accounts({\n    escrow: escrowPDA,\n    player1: provider.wallet.publicKey,\n    authority: provider.wallet.publicKey,\n    systemProgram: SystemProgram.programId\n  }).rpc(); // uses default preflight & will prompt the wallet\n\n  return escrowPDA;\n}\n\n/** \n * @param {PublicKey} escrowPDA \n * @param {anchor.AnchorProvider} provider \n */\nexport async function depositToEscrow(escrowPDA, provider) {\n  const program = new anchor.Program(idl, PROGRAM_ID, provider);\n  const escrowAccount = await program.account.escrow.fetch(escrowPDA);\n  await program.methods.deposit().accounts({\n    escrow: escrowPDA,\n    payer: provider.wallet.publicKey,\n    escrowAccount: escrowAccount.escrowAccount,\n    systemProgram: SystemProgram.programId\n  }).rpc(); // again, default settings so wallet will prompt\n}\n\n/** \n * @param {PublicKey} escrowPDA \n * @param {anchor.AnchorProvider} provider \n */\nexport async function joinAndDeposit(escrowPDA, provider) {\n  const program = new anchor.Program(idl, PROGRAM_ID, provider);\n  const escrowAccount = await program.account.escrow.fetch(escrowPDA);\n  await program.methods.joinAndDeposit().accounts({\n    escrow: escrowPDA,\n    player2: provider.wallet.publicKey,\n    escrowAccount: escrowAccount.escrowAccount,\n    systemProgram: SystemProgram.programId\n  }).rpc();\n}\nexport async function cancelEscrow(escrowPDA, player1Pubkey, player2Pubkey, provider) {\n  const program = new anchor.Program(idl, PROGRAM_ID, provider);\n  const escrowAccount = await program.account.escrow.fetch(escrowPDA);\n  await program.methods.cancel().accounts({\n    escrow: escrowPDA,\n    player1: player1Pubkey,\n    player2: player2Pubkey,\n    escrowAccount: escrowAccount.escrowAccount,\n    authority: provider.wallet.publicKey\n  }).rpc();\n}\nexport async function resolveEscrow(escrowPDA, winnerPubkey, provider) {\n  const program = new anchor.Program(idl, PROGRAM_ID, provider);\n  const escrowAccount = await program.account.escrow.fetch(escrowPDA);\n  await program.methods.resolve(winnerPubkey).accounts({\n    escrow: escrowPDA,\n    winner: winnerPubkey,\n    house: provider.wallet.publicKey,\n    escrowAccount: escrowAccount.escrowAccount,\n    authority: provider.wallet.publicKey\n  }).rpc();\n}","map":{"version":3,"names":["anchor","PublicKey","SystemProgram","idl","PROGRAM_ID","metadata","address","initializeEscrow","wagerLamports","provider","program","Program","nonce","Math","floor","random","escrowPDA","findProgramAddress","Buffer","from","wallet","publicKey","toBuffer","BN","toArrayLike","programId","methods","initialize","accounts","escrow","player1","authority","systemProgram","rpc","depositToEscrow","escrowAccount","account","fetch","deposit","payer","joinAndDeposit","player2","cancelEscrow","player1Pubkey","player2Pubkey","cancel","resolveEscrow","winnerPubkey","resolve","winner","house"],"sources":["/home/kokoi/sol-wager-app/frontend/src/escrow.js"],"sourcesContent":["// src/escrow.js\nimport * as anchor from \"@coral-xyz/anchor\";\nimport { PublicKey, SystemProgram } from \"@solana/web3.js\";\nimport idl from \"./idl/typeracer_escrow.json\";\n\nconst PROGRAM_ID = new PublicKey(idl.metadata.address);\n\n/** \n * @param {number} wagerLamports \n * @param {anchor.AnchorProvider} provider \n * @returns {Promise<PublicKey>} PDA \n */\nexport async function initializeEscrow(wagerLamports, provider) {\n  const program = new anchor.Program(idl, PROGRAM_ID, provider);\n  const nonce = Math.floor(Math.random() * 1_000_000);\n  const [escrowPDA] = await PublicKey.findProgramAddress(\n    [\n      Buffer.from(\"escrow\"),\n      provider.wallet.publicKey.toBuffer(),\n      new anchor.BN(nonce).toArrayLike(Buffer, \"le\", 8),\n    ],\n    program.programId\n  );\n\n  await program.methods\n    .initialize(new anchor.BN(wagerLamports), new anchor.BN(nonce))\n    .accounts({\n      escrow: escrowPDA,\n      player1: provider.wallet.publicKey,\n      authority: provider.wallet.publicKey,\n      systemProgram: SystemProgram.programId,\n    })\n    .rpc();   // uses default preflight & will prompt the wallet\n\n  return escrowPDA;\n}\n\n/** \n * @param {PublicKey} escrowPDA \n * @param {anchor.AnchorProvider} provider \n */\nexport async function depositToEscrow(escrowPDA, provider) {\n  const program = new anchor.Program(idl, PROGRAM_ID, provider);\n  const escrowAccount = await program.account.escrow.fetch(escrowPDA);\n\n  await program.methods\n    .deposit()\n    .accounts({\n      escrow: escrowPDA,\n      payer: provider.wallet.publicKey,\n      escrowAccount: escrowAccount.escrowAccount,\n      systemProgram: SystemProgram.programId,\n    })\n    .rpc();   // again, default settings so wallet will prompt\n}\n\n/** \n * @param {PublicKey} escrowPDA \n * @param {anchor.AnchorProvider} provider \n */\nexport async function joinAndDeposit(escrowPDA, provider) {\n  const program = new anchor.Program(idl, PROGRAM_ID, provider);\n  const escrowAccount = await program.account.escrow.fetch(escrowPDA);\n\n  await program.methods\n    .joinAndDeposit()\n    .accounts({\n      escrow: escrowPDA,\n      player2: provider.wallet.publicKey,\n      escrowAccount: escrowAccount.escrowAccount,\n      systemProgram: SystemProgram.programId,\n    })\n    .rpc();\n}\n\nexport async function cancelEscrow(\n  escrowPDA,\n  player1Pubkey,\n  player2Pubkey,\n  provider\n) {\n  const program = new anchor.Program(idl, PROGRAM_ID, provider);\n  const escrowAccount = await program.account.escrow.fetch(escrowPDA);\n\n  await program.methods\n    .cancel()\n    .accounts({\n      escrow: escrowPDA,\n      player1: player1Pubkey,\n      player2: player2Pubkey,\n      escrowAccount: escrowAccount.escrowAccount,\n      authority: provider.wallet.publicKey,\n    })\n    .rpc();\n}\n\nexport async function resolveEscrow(escrowPDA, winnerPubkey, provider) {\n  const program = new anchor.Program(idl, PROGRAM_ID, provider);\n  const escrowAccount = await program.account.escrow.fetch(escrowPDA);\n\n  await program.methods\n    .resolve(winnerPubkey)\n    .accounts({\n      escrow: escrowPDA,\n      winner: winnerPubkey,\n      house: provider.wallet.publicKey,\n      escrowAccount: escrowAccount.escrowAccount,\n      authority: provider.wallet.publicKey,\n    })\n    .rpc();\n}\n"],"mappings":"AAAA;AACA,OAAO,KAAKA,MAAM,MAAM,mBAAmB;AAC3C,SAASC,SAAS,EAAEC,aAAa,QAAQ,iBAAiB;AAC1D,OAAOC,GAAG,MAAM,6BAA6B;AAE7C,MAAMC,UAAU,GAAG,IAAIH,SAAS,CAACE,GAAG,CAACE,QAAQ,CAACC,OAAO,CAAC;;AAEtD;AACA;AACA;AACA;AACA;AACA,OAAO,eAAeC,gBAAgBA,CAACC,aAAa,EAAEC,QAAQ,EAAE;EAC9D,MAAMC,OAAO,GAAG,IAAIV,MAAM,CAACW,OAAO,CAACR,GAAG,EAAEC,UAAU,EAAEK,QAAQ,CAAC;EAC7D,MAAMG,KAAK,GAAGC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,GAAG,OAAS,CAAC;EACnD,MAAM,CAACC,SAAS,CAAC,GAAG,MAAMf,SAAS,CAACgB,kBAAkB,CACpD,CACEC,MAAM,CAACC,IAAI,CAAC,QAAQ,CAAC,EACrBV,QAAQ,CAACW,MAAM,CAACC,SAAS,CAACC,QAAQ,CAAC,CAAC,EACpC,IAAItB,MAAM,CAACuB,EAAE,CAACX,KAAK,CAAC,CAACY,WAAW,CAACN,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC,CAClD,EACDR,OAAO,CAACe,SACV,CAAC;EAED,MAAMf,OAAO,CAACgB,OAAO,CAClBC,UAAU,CAAC,IAAI3B,MAAM,CAACuB,EAAE,CAACf,aAAa,CAAC,EAAE,IAAIR,MAAM,CAACuB,EAAE,CAACX,KAAK,CAAC,CAAC,CAC9DgB,QAAQ,CAAC;IACRC,MAAM,EAAEb,SAAS;IACjBc,OAAO,EAAErB,QAAQ,CAACW,MAAM,CAACC,SAAS;IAClCU,SAAS,EAAEtB,QAAQ,CAACW,MAAM,CAACC,SAAS;IACpCW,aAAa,EAAE9B,aAAa,CAACuB;EAC/B,CAAC,CAAC,CACDQ,GAAG,CAAC,CAAC,CAAC,CAAG;;EAEZ,OAAOjB,SAAS;AAClB;;AAEA;AACA;AACA;AACA;AACA,OAAO,eAAekB,eAAeA,CAAClB,SAAS,EAAEP,QAAQ,EAAE;EACzD,MAAMC,OAAO,GAAG,IAAIV,MAAM,CAACW,OAAO,CAACR,GAAG,EAAEC,UAAU,EAAEK,QAAQ,CAAC;EAC7D,MAAM0B,aAAa,GAAG,MAAMzB,OAAO,CAAC0B,OAAO,CAACP,MAAM,CAACQ,KAAK,CAACrB,SAAS,CAAC;EAEnE,MAAMN,OAAO,CAACgB,OAAO,CAClBY,OAAO,CAAC,CAAC,CACTV,QAAQ,CAAC;IACRC,MAAM,EAAEb,SAAS;IACjBuB,KAAK,EAAE9B,QAAQ,CAACW,MAAM,CAACC,SAAS;IAChCc,aAAa,EAAEA,aAAa,CAACA,aAAa;IAC1CH,aAAa,EAAE9B,aAAa,CAACuB;EAC/B,CAAC,CAAC,CACDQ,GAAG,CAAC,CAAC,CAAC,CAAG;AACd;;AAEA;AACA;AACA;AACA;AACA,OAAO,eAAeO,cAAcA,CAACxB,SAAS,EAAEP,QAAQ,EAAE;EACxD,MAAMC,OAAO,GAAG,IAAIV,MAAM,CAACW,OAAO,CAACR,GAAG,EAAEC,UAAU,EAAEK,QAAQ,CAAC;EAC7D,MAAM0B,aAAa,GAAG,MAAMzB,OAAO,CAAC0B,OAAO,CAACP,MAAM,CAACQ,KAAK,CAACrB,SAAS,CAAC;EAEnE,MAAMN,OAAO,CAACgB,OAAO,CAClBc,cAAc,CAAC,CAAC,CAChBZ,QAAQ,CAAC;IACRC,MAAM,EAAEb,SAAS;IACjByB,OAAO,EAAEhC,QAAQ,CAACW,MAAM,CAACC,SAAS;IAClCc,aAAa,EAAEA,aAAa,CAACA,aAAa;IAC1CH,aAAa,EAAE9B,aAAa,CAACuB;EAC/B,CAAC,CAAC,CACDQ,GAAG,CAAC,CAAC;AACV;AAEA,OAAO,eAAeS,YAAYA,CAChC1B,SAAS,EACT2B,aAAa,EACbC,aAAa,EACbnC,QAAQ,EACR;EACA,MAAMC,OAAO,GAAG,IAAIV,MAAM,CAACW,OAAO,CAACR,GAAG,EAAEC,UAAU,EAAEK,QAAQ,CAAC;EAC7D,MAAM0B,aAAa,GAAG,MAAMzB,OAAO,CAAC0B,OAAO,CAACP,MAAM,CAACQ,KAAK,CAACrB,SAAS,CAAC;EAEnE,MAAMN,OAAO,CAACgB,OAAO,CAClBmB,MAAM,CAAC,CAAC,CACRjB,QAAQ,CAAC;IACRC,MAAM,EAAEb,SAAS;IACjBc,OAAO,EAAEa,aAAa;IACtBF,OAAO,EAAEG,aAAa;IACtBT,aAAa,EAAEA,aAAa,CAACA,aAAa;IAC1CJ,SAAS,EAAEtB,QAAQ,CAACW,MAAM,CAACC;EAC7B,CAAC,CAAC,CACDY,GAAG,CAAC,CAAC;AACV;AAEA,OAAO,eAAea,aAAaA,CAAC9B,SAAS,EAAE+B,YAAY,EAAEtC,QAAQ,EAAE;EACrE,MAAMC,OAAO,GAAG,IAAIV,MAAM,CAACW,OAAO,CAACR,GAAG,EAAEC,UAAU,EAAEK,QAAQ,CAAC;EAC7D,MAAM0B,aAAa,GAAG,MAAMzB,OAAO,CAAC0B,OAAO,CAACP,MAAM,CAACQ,KAAK,CAACrB,SAAS,CAAC;EAEnE,MAAMN,OAAO,CAACgB,OAAO,CAClBsB,OAAO,CAACD,YAAY,CAAC,CACrBnB,QAAQ,CAAC;IACRC,MAAM,EAAEb,SAAS;IACjBiC,MAAM,EAAEF,YAAY;IACpBG,KAAK,EAAEzC,QAAQ,CAACW,MAAM,CAACC,SAAS;IAChCc,aAAa,EAAEA,aAAa,CAACA,aAAa;IAC1CJ,SAAS,EAAEtB,QAAQ,CAACW,MAAM,CAACC;EAC7B,CAAC,CAAC,CACDY,GAAG,CAAC,CAAC;AACV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}